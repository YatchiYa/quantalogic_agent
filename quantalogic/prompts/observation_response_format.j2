# Task Execution Analysis

ğŸ“Š Iteration: {{ iteration }}/{{ max_iterations }}

### Current Task
```
{{ task_to_solve_summary }}
```

### Task Complexity
ğŸ¯ Level: [Simple|Standard|Complex]
ğŸ“ˆ Progress: {{ progress_percentage }}%
â±ï¸ Time Elapsed: {{ elapsed_time }}

### Available Resources
ğŸ› ï¸ Tools: {{ tools_prompt }}
ğŸ“¦ State: {{ variables_prompt }}

### Last Action Result
Tool: {{ last_executed_tool }}
Status: {{ 'SUCCESS' if last_executed_tool else 'NO_TOOL_EXECUTED' }}
<{{ variable_name }}>
{{ response_display }}
</{{ variable_name }}>

{% if progress_metadata %}
### Progress Tracking
Step: {{ progress_metadata.step }}/{{ progress_metadata.total_steps }}
Progress: {{ progress_metadata.percentage }}%
Status: {{ progress_metadata.status }}
{% if progress_metadata.error %}
Error: {{ progress_metadata.error }}
{% endif %}
{% endif %}

{% if execution_error %}
### Error Details
```
{{ execution_error }}
```
{% endif %}

### Response Requirements

[IF Simple Task]
Provide focused solution in TWO blocks:

1. Analysis Block (<thinking>):
   â€¢ Track tool call count (max 2)
   â€¢ Validate action result
   â€¢ Confirm completion status
   â€¢ If not complete after 2 calls:
     - Escalate to standard complexity
     - Request user guidance

2. Action Block (<action>):
   â€¢ Execute precise tool call
   â€¢ Use clear parameters
   â€¢ Include completion criteria

[ELSE]
Provide detailed analysis in TWO blocks:

1. Analysis Block (<thinking>):
   â€¢ Update progress tracking
   â€¢ Evaluate action results
   â€¢ Determine next step
   â€¢ Track completion status
   â€¢ Handle any errors

2. Action Block (<action>):
   â€¢ Select ONE tool
   â€¢ Use variable interpolation
   â€¢ Provide precise parameters

### Response Format

[IF Simple Task]
```xml
<thinking>
  <progress_tracker>
    â€¢ ğŸ¯ Task Type: Simple
    â€¢ ğŸ”„ Tool Calls: [N/2]
    â€¢ âœ… Previous Result: [Success/Failure/Error: specific error type]
    â€¢ ğŸ“Š Status: [In Progress/Need Escalation/Blocked]
  </progress_tracker>

  <quick_assessment>
    â€¢ âœ… Result: [Outcome with specific details from tool output]
    â€¢ ğŸ“Š Status: [Complete/Pending/Error]
    â€¢ âš¡ Next: [Action/Complete/Escalate/Retry with modification]
    â€¢ ğŸ” Validation: [How output was validated or why it failed]
  </quick_assessment>
</thinking>

<action>
<tool_name>
  [Parameters]
</tool_name>
</action>
```

[ELSE]
```xml
<thinking>
  <progress_tracker>
    â€¢ âœ… Completed: [List each completed step with number and action: "Step 1: Action X", "Step 2: Action Y"]
    â€¢ ğŸ¯ Current: [Active step number and full action description: "Step 3: Generate content for Z"]
    â€¢ ğŸ“ Pending: [List remaining steps with numbers and actions: "Step 4: Write content", "Step 5: Format output"]
    â€¢ ğŸ“Š Progress: [X/Y steps] ([Calculate exact percentage]%)
  </progress_tracker>

  <execution_state>
    â€¢ ğŸ”„ Last Result: [Detailed outcome with specific data points from response]
    â€¢ ğŸš« Error Status: [None/Specific error with root cause analysis - look for "Error:" prefix in tool output]
    â€¢ âš¡ Next Action: [Plan with fallback if needed]
    â€¢ ğŸ’¾ State Update: [Specific variable changes based on tool output]
    â€¢ âš ï¸ Issues: [Specific blockers with proposed solutions]
    â€¢ ğŸ” Loop Detection: [Identify if similar action was attempted before - compare with previous actions to avoid repeating failed operations]
  </execution_state>
</thinking>

<action>
<tool_name>
  [Parameters]
</tool_name>
</action>
```

### Critical Rules
1. âœ… Match response format to task complexity
2. ğŸ¯ Follow execution plan strictly
3. ğŸ’¾ Use variable content, not names
4. ğŸ“ Structure output in markdown
5. ğŸ”„ Revise plan on failures with specific modifications
6. âš¡ Complete task when all steps done
7. ğŸ” Validate results before completion
8. ğŸš« After 3 similar failures, try completely different approach
9. ğŸ” Detect and break loops by tracking previous actions
10. ğŸ“Š Extract and use specific data points from tool responses
